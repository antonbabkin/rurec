---

title: InfoGroup data


keywords: fastai
sidebar: home_sidebar

summary: "Specify schema and convert raw CSV to a partitioned parquet dataset."
description: "Specify schema and convert raw CSV to a partitioned parquet dataset."
nb_path: "nbs/infogroup.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/infogroup.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Start with original data files in CSV format.</li>
<li>Upgrade old datapackage.json schema.</li>
<li>Rename columns and standardize to ALL_CAPS.</li>
<li>In 2009: pad string fields with zeroes.</li>
<li>Validate values format, replace errors with missing values.</li>
<li>Save to disk in parquet format.<ul>
<li>Excluding variables that are not present in all years and POPULATION_CODE.</li>
</ul>
</li>
<li>Provide interface to load data as DataFrame, with options to select columns and subsamples by year and state.</li>
</ul>
<h2 id="Possible-future-work">Possible future work<a class="anchor-link" href="#Possible-future-work"> </a></h2><ul>
<li>add indicator variables for different samples (random, WI, FAI, ...) to be used as parquet partitions to allow quick read of data subsets</li>
<li>put meaningfult labels to categoricals ("1-5" instead if "A" etc).<ul>
<li>This will be tricky for POPULATION_CODE that changes coding between 2015 and 2016</li>
</ul>
</li>
<li>make up and add enum constraints for TITLE_CODE and CALL_STATUS_CODE</li>
<li>if categoricals are worthy on fields with large number of unique values, possible unknown a priori, such as city or NAICS, then they should be applied. care should be taken because set of unique values can vary between years, and it might create problems when merging.</li>
<li>few variables have many values like "00000", those should possibly be replaced with np.nan<ul>
<li>subsidiary_number, parent_number, site_number, census_tract, csa_code, maybe others</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_schema" class="doc_header"><code>convert_schema</code><a href="https://github.com/antonbabkin/rurec/tree/master/rurec/infogroup.py#L36" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_schema</code>(<strong><code>datapackage_schema_path</code></strong>)</p>
</blockquote>
<p>Convert old datapackage schema.json into a new file, to be used for data validation.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_schema" class="doc_header"><code>get_schema</code><a href="https://github.com/antonbabkin/rurec/tree/master/rurec/infogroup.py#L106" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_schema</code>(<strong><code>field_name</code></strong>=<em><code>None</code></em>, <strong><code>year</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Flexible function to get dataset schema.</p>
<p>With no parameters, return full list of field dictionaries.
With <code>year</code>, restrict to fields present in that year.
With <code>field_name</code>, return dictionary for specific field (<code>year</code> is ignored in this case).</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pad_with_zeroes" class="doc_header"><code>pad_with_zeroes</code><a href="https://github.com/antonbabkin/rurec/tree/master/rurec/infogroup.py#L121" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pad_with_zeroes</code>(<strong><code>df</code></strong>, <strong><code>schema_fields</code></strong>)</p>
</blockquote>
<p>Prepend string column values with zeroes to have constant width.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="validate_raw_strings" class="doc_header"><code>validate_raw_strings</code><a href="https://github.com/antonbabkin/rurec/tree/master/rurec/infogroup.py#L128" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>validate_raw_strings</code>(<strong><code>df</code></strong>, <strong><code>schema_fields</code></strong>)</p>
</blockquote>
<p>Validate values in raw InfoGroup data according to string constraints.
Return list of dicts of invalid values.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_dtypes" class="doc_header"><code>convert_dtypes</code><a href="https://github.com/antonbabkin/rurec/tree/master/rurec/infogroup.py#L181" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_dtypes</code>(<strong><code>df</code></strong>, <strong><code>schema_fields</code></strong>)</p>
</blockquote>
<p>Inplace convert string columns to appropriate types.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="validate_raw_numbers" class="doc_header"><code>validate_raw_numbers</code><a href="https://github.com/antonbabkin/rurec/tree/master/rurec/infogroup.py#L192" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>validate_raw_numbers</code>(<strong><code>df</code></strong>, <strong><code>year</code></strong>)</p>
</blockquote>
<p>Validate values in raw InfoGroup data according to numerical constraints.
Return list of dicts of invalid values.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="replace_invalid" class="doc_header"><code>replace_invalid</code><a href="https://github.com/antonbabkin/rurec/tree/master/rurec/infogroup.py#L209" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>replace_invalid</code>(<strong><code>df</code></strong>, <strong><code>invalid_list</code></strong>, <strong><code>replacement</code></strong>=<em><code>nan</code></em>)</p>
</blockquote>
<p>Replace invalid values.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_validate_convert" class="doc_header"><code>load_validate_convert</code><a href="https://github.com/antonbabkin/rurec/tree/master/rurec/infogroup.py#L222" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_validate_convert</code>(<strong><code>year</code></strong>)</p>
</blockquote>
<p>Run full processing pipeline on one year of data:
load CVS, validate values, convert dtypes and save as parquet partition.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="build_parquet_dataset" class="doc_header"><code>build_parquet_dataset</code><a href="https://github.com/antonbabkin/rurec/tree/master/rurec/infogroup.py#L270" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>build_parquet_dataset</code>(<strong><code>n_cpus</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<p>Create full parquet dataset from yearly CSV files.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_df" class="doc_header"><code>get_df</code><a href="https://github.com/antonbabkin/rurec/tree/master/rurec/infogroup.py#L289" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_df</code>(<strong><code>years</code></strong>=<em><code>None</code></em>, <strong><code>cols</code></strong>=<em><code>None</code></em>, <strong><code>states</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Return one year of InfoGroup data with appropriate data types.
Subset of columns can be loaded by passing list to <code>cols</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

